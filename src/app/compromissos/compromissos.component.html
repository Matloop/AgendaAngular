<!-- src/app/compromissos/compromissos.component.html -->
<div class="container">
  <h2>Gerenciamento de Compromissos</h2>

  <!-- Formulário de Adição -->
  <div *ngIf="mostrarFormulario" class="form-container">
    <h3>Adicionar Novo Compromisso</h3>
    <div class="form-group">
      <label for="titulo">Título:</label>
      <input id="titulo" [(ngModel)]="compromissoEditando.titulo" placeholder="Título do compromisso">
    </div>
    <div class="form-group">
      <label for="descricao">Descrição:</label>
      <textarea id="descricao" [(ngModel)]="compromissoEditando.descricao" placeholder="Descrição detalhada"></textarea>
    </div>
    <div class="form-group">
      <label for="data">Data:</label>
      <input id="data" [(ngModel)]="compromissoEditando.data" placeholder="Data" type="date">
    </div>
    <div class="form-group">
      <label for="hora">Hora:</label>
      <input id="hora" [(ngModel)]="compromissoEditando.hora" placeholder="Hora" type="time">
    </div>
    <div class="form-group">
      <label for="contato">Contato:</label>
      <select id="contato" [(ngModel)]="compromissoEditando.contatoId">
        <option [value]="0" disabled>Selecione um contato</option>
        <option *ngFor="let contato of contatos" [value]="contato.id">{{ contato.nome }}</option>
      </select>
    </div>
    <div class="form-group">
      <label for="local">Local:</label>
      <select id="local" [(ngModel)]="compromissoEditando.localId">
        <option [value]="0" disabled>Selecione um local</option>
        <option *ngFor="let local of locais" [value]="local.id">{{ local.nome }}</option>
      </select>
    </div>
    <div class="buttons-group">
      <button (click)="adicionarCompromisso()" class="btn-save">Salvar</button>
      <button (click)="mostrarFormulario = false" class="btn-cancel">Cancelar</button>
    </div>
  </div>

  <!-- Botão de Adicionar -->
  <button *ngIf="!mostrarFormulario" (click)="exibirFormulario()" class="btn-add">Adicionar Compromisso</button>

  <!-- Lista de Compromissos -->
  <div class="compromissos-list">
    <table>
      <thead>
        <tr>
          <th>Título</th>
          <th>Data</th>
          <th>Hora</th>
          <th>Contato</th>
          <th>Local</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let compromisso of compromissos">
          <ng-container *ngIf="compromissoAtualId !== compromisso.id; else editFormRow">
            <td>{{ compromisso.titulo }}</td>
            <td>{{ compromisso.data }}</td>
            <td>{{ compromisso.hora }}</td>
            <td>{{ getNomeContato(compromisso.contatoId) }}</td>
            <td>{{ getNomeLocal(compromisso.localId) }}</td>
            <td class="actions">
              <button 
                *ngIf="podeEditarCompromisso(compromisso)" 
                (click)="editarCompromisso(compromisso.id!)" 
                class="btn-edit">Editar</button>
              <button 
                *ngIf="podeEditarCompromisso(compromisso)" 
                (click)="deletarCompromisso(compromisso.id!)" 
                class="btn-delete">Excluir</button>
            </td>
          </ng-container>

          <ng-template #editFormRow>
            <td colspan="6" *ngIf="mostrarEdicaoForm" class="edit-form-cell">
              <div class="edit-form">
                <div class="form-group">
                  <label for="editTitulo">Título:</label>
                  <input id="editTitulo" [(ngModel)]="compromissoEditando.titulo" placeholder="Título do compromisso">
                </div>
                <div class="form-group">
                  <label for="editDescricao">Descrição:</label>
                  <textarea id="editDescricao" [(ngModel)]="compromissoEditando.descricao" placeholder="Descrição detalhada"></textarea>
                </div>
                <div class="form-group">
                  <label for="editData">Data:</label>
                  <input id="editData" [(ngModel)]="compromissoEditando.data" placeholder="Data" type="date">
                </div>
                <div class="form-group">
                  <label for="editHora">Hora:</label>
                  <input id="editHora" [(ngModel)]="compromissoEditando.hora" placeholder="Hora" type="time">
                </div>
                <div class="form-group">
                  <label for="editContato">Contato:</label>
                  <select id="editContato" [(ngModel)]="compromissoEditando.contatoId">
                    <option *ngFor="let contato of contatos" [value]="contato.id">{{ contato.nome }}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="editLocal">Local:</label>
                  <select id="editLocal" [(ngModel)]="compromissoEditando.localId">
                    <option *ngFor="let local of locais" [value]="local.id">{{ local.nome }}</option>
                  </select>
                </div>
                <div class="buttons-group">
                  <button (click)="confirmarEdicao()" class="btn-save">Salvar</button>
                  <button (click)="cancelarEdicao()" class="btn-cancel">Cancelar</button>
                </div>
              </div>
            </td>
          </ng-template>
        </tr>
      </tbody>
    </table>
  </div>
</div>